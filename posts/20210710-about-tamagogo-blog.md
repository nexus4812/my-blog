---
title: "月額100円代でめっちゃ速いブログ作りました（Next.js+S3）"
date: "2021-07-10"
---

## 経緯
自分のブログを作成してみたかったのですが、DB付きのレンタルサーバーを借りるとどうやっても毎月500円はかかってしまうので、もっと費用を落としたいと考えたのがきっかけ。

## 要件

#### 必須
- 安価で維持費が気にならないようにする
- とにかく表示速度を速くする
- ある程度SEOを意識する

#### ついでにやります
- CIでの文法チェック（テストはまたの機会に、、、）
- CDでのデプロイ/ビルドの自動化

## 使った技術
上記の要件を満たすために、Next.jsでSSG(Static Site Generator)した静的なHTMLファイルをAWS S3にアップロードして費用を落とすことにしました。

<img src="https://i.gyazo.com/7408a985c7061323454219c7ed85796b.png" alt="Image from Gyazo" width="900"/>


「WordPress + StaticPress + AWS S3」という構成も考えましたが、編集の度にEC2を起動するのは面倒くさいのでやめました。

#### メリット
- サーバーレス構成なので、AWSが生き続ける限りは絶対に落ちない。負荷分散とか考えなくてよい。
- クラッキング等の被害もさほど懸念しなくてよい（AWSのキー流出だけは注意）
- ミドルウェアの保守コストが全くかからない（OS、DBのバージョンアップ作業など）
- 静的HTMLを配信しているだけなので安い速い

#### デメリット
- 変更を加えると必ず再ビルドが必要
- MarkdownをHTMLにコンパイルしているので、デザインの変更に弱い(テーブルデザインの複数作成などは難しい)
  
再ビルドの問題は[microcms](https://microcms.io/ )などの外部APIを使えば解決できそうです。    
ただJSでレンダリングする必要があり表示速度が遅くなります。トレードオフですね。


## パフォーマンス
[![Image from Gyazo](https://i.gyazo.com/5a4ef8886e9a0cbca0f4b8610a0e1c2f.png)](https://gyazo.com/5a4ef8886e9a0cbca0f4b8610a0e1c2f)

[Lighthouse](https://developers.google.com/web/tools/lighthouse?hl=ja) にて測定、細かい部分では数点指摘されていますが概ね良好です。

あとはコンテンツの内容がよければ？SEOでも上がっていくと思われます

## 運用コスト
| サービス                 | 月額費用          | 
| ------------------------ | ----------------- | 
| ドメイン費用　　 | 108円(年間1300円) | 
| AWS Route53              | 55円 (0.5USD)     | 
| AWS S3                   | 2円 (0.02USD)     | 
| AWS CloudFront           | 0円 (無料枠)      | 
| Github Actions           | 0円 (無料枠)      | 
|                          |                   | 
| 合計                     | 165円             | 

現在アクセスが少ないのと無料枠で補っているのでこの値段で運用し続けれるか謎ですが、かなり破格の値段で運用できています。

ドメインを除くと超高速サイトが月額100円以下で運用できるのは驚きですね、、、（最近は無料でドメイン取得できるみたいですし）


## Github
具体的な技術、コードに関しては[レポジトリ](https://github.com/nexus4812/my-blog)を参照

<iframe style="width:100%;height:155px;margin:15px 0;max-width:500px;" title="tama-go-go" src="https://hatenablog-parts.com/embed?url=https://github.com/nexus4812/my-blog" frameborder="0" scrolling="no"></iframe>

## やってみた所感
簡単なサイトであればサーバー不要の時代はもうそこまで来てそうです。  
コーポレートサイト等であれば、この構成＋LambdaAPIでお問い合わせフォームなど動的な部分をつくれば格安で運用できそうです。

またSSRなどリッチなことをしなければ、フロントエンドをS3にしてバックエンドサーバだけ用意するなどの方法でも十分通用しそうですね。

